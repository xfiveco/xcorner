<div class="js-product-view u-container c-product grid md:grid-cols-product mt-8 md:gap-8"
    {{#if settings.data_tag_enabled}}
        data-event-type="product"
        data-entity-id="{{product.id}}"
        data-name="{{product.title}}"
        data-product-category="
            {{#each product.category}}
                {{#if @last}}{{this}}{{else}}{{this}}, {{/if}}
            {{/each}}"
        data-product-brand="{{product.brand.name}}"
        data-product-price="
            {{#or customer (unless settings.hide_price_from_guests)}}
                {{#if product.price.with_tax}}
                    {{product.price.with_tax.value}}
                {{else}}
                    {{product.price.without_tax.value}}
                {{/if}}
            {{else}}
                {{lang 'common.login_for_pricing'}}
            {{/or}}"
        data-product-variant="single-product-option"
    {{/if}}
>
    {{#each product.reviews.messages}}
        {{#if error}}
            {{> components/common/alert/alert-error error}}
        {{/if}}
        {{#if success}}
            {{> components/common/alert/alert-success success}}
        {{/if}}
    {{/each}}

    <section class="js-product-view-images js-image-gallery c-product__gallery relative">
        {{!--
            Note that these image sizes are coupled to image sizes used in /assets/js/theme/common/product-details.js
            for variant/rule image replacement
        --}}
        {{#if product.images.length '>' 1 }}
            {{> components/carousel/content-announcement}}
        {{/if}}

        <figure class="js-product-view-image js-image-gallery-main shadow-inner mb-4 p-2"
            {{#if product.main_image}}
                data-zoom-image="{{getImageSrcset product.main_image (cdn theme_settings.default_image_product) 1x=theme_settings.zoom_size }}"
            {{/if}}
        >
            <div>
                {{!-- Remove the surrounding a-element if there is no main image. --}}
                {{#if product.main_image}}
                    <a 
                        href="{{getImageSrcset product.main_image (cdn theme_settings.default_image_product) 1x=theme_settings.zoom_size}}"
                        target="_blank"
                    >
                {{/if}}

                {{> components/common/image
                    image=product.main_image
                    class="js-main-image"
                    fallback_size=theme_settings.product_size
                    default_image=theme_settings.default_image_product
                }}
                {{!-- Remove the surrounding a-element if there is no main image. --}}
                {{#if product.main_image}}
                    </a>
                {{/if}}
            </div>
        </figure>

        <ul class="o-list-bare c-product__thumbs js-product-view-thumbnails grid grid-cols-4 p-2 gap-4 shadow-inner">
            {{#each product.images}}
                <li>
                    <a
                        class="js-image-gallery-item"
                        href="{{getImageSrcset this (cdn ../theme_settings.default_image_product) 1x=../theme_settings.zoom_size}}"
                        data-image-gallery-new-image-url="{{getImageSrcset this (cdn ../theme_settings.default_image_product) 1x=../theme_settings.product_size}}"
                        data-image-gallery-new-image-srcset="{{getImageSrcset this use_default_sizes=true}}"
                        data-image-gallery-zoom-image-url="{{getImageSrcset this (cdn ../theme_settings.default_image_product) 1x=../theme_settings.zoom_size}}"
                    >
                    {{> components/common/image
                        image=this
                        fallback_size=../theme_settings.product_view_thumb_size
                    }}
                    </a>
                </li>
            {{/each}}
        </ul>
    </section>

    <section class="c-product__info">
            <h1 class="js-product-view-title font-bold text-3xl">
                {{product.title}}
            </h1>
            
            {{#if product.brand}}
                <div>
                    <a href="{{product.brand.url}}">
                        <span>{{product.brand.name}}</span>
                    </a>
                </div>
            {{/if}}
            {{#if product.call_for_price}}
                <p>
                    <span>{{product.call_for_price}}</span>
                </p>
            {{/if}}
            
            <div class="font-bold text-lg">
                {{#or customer (unless settings.hide_price_from_guests)}}
                    {{> components/products/price price=product.price}}
                {{else}}
                    {{> components/common/login-for-pricing}}
                {{/or}}
            </div>
            {{{region name="product_below_price"}}}
            
            <div class="flex gap-4 items-center my-4">
                {{#if settings.show_product_rating}}
                    {{> components/products/ratings rating=product.rating}}

                    {{#if product.num_reviews '>' 0}}
                        <a href="{{product.url}}{{#if is_ajax}}#product-reviews{{/if}}" class="js-product-review-link">
                            {{lang 'products.reviews.link_to_review' total=product.num_reviews}}
                        </a>
                    {{else}}
                        <span>
                            {{lang 'products.reviews.link_to_review' total=product.num_reviews}}
                        </span>
                    {{/if}}
                {{/if}}
                {{#if settings.show_product_reviews}}
                    <a 
                        {{#if is_ajax}}
                            href="{{product.url}}#write_review"
                        {{else}}
                            data-reveal-id="modal-review-form"
                        {{/if}}
                        role="button"
                    >
                       {{lang 'products.reviews.new'}}
                    </a>
                    {{#unless is_ajax}}
                        {{> components/products/modals/writeReview}}
                    {{/unless}}
                {{/if}}
            </div>
            
            {{product.detail_messages}}

            <dl class="js-product-view-info">
                <dt class="js-sku-label font-bold text-sm"{{#unless product.sku}} style="display: none;"{{/unless}}>
                    {{lang 'products.sku'}}
                </dt>
                <dd class="js-product-sku">
                    {{product.sku}}
                </dd>
                
                <dt class="js-upc-label font-bold text-sm"{{#unless product.upc}} style="display: none;"{{/unless}}>
                    {{lang 'products.upc'}}
                </dt>
                <dd class="js-product-upc">
                    {{product.upc}}
                </dd>
                
                {{#if product.condition}}
                    <dt class="font-bold text-sm">{{lang 'products.condition'}}</dt>
                    <dd>{{product.condition}}</dd>
                {{/if}}
                
                {{#if product.availability}}
                    <dt class="font-bold text-sm">{{lang 'products.availability'}}</dt>
                    <dd>{{product.availability}}</dd>
                {{/if}}
                
                {{#all product.weight theme_settings.show_product_weight}}
                    <dt class="font-bold text-sm">{{lang 'products.weight'}}</dt>
                    <dd class="js-product-weight">
                        {{product.weight}}
                    </dd>
                {{/all}}

                {{#all product.width product.height product.depth theme_settings.show_product_dimensions}}
                    <dt class="font-bold text-sm">{{lang 'products.width'}}</dt>
                    <dd>
                        {{product.width}}
                        {{#if settings.measurements.length '==' 'Centimeters'}}
                            ({{lang 'products.measurement.metric'}})
                        {{else}}
                            ({{lang 'products.measurement.imperial'}})
                        {{/if}}
                    </dd>
                    
                    <dt class="font-bold text-sm">{{lang 'products.height'}}</dt>
                    <dd>
                        {{product.height}}
                        {{#if settings.measurements.length '==' 'Centimeters'}}
                            ({{lang 'products.measurement.metric'}})
                        {{else}}
                            ({{lang 'products.measurement.imperial'}})
                        {{/if}}
                    </dd>

                    <dt class="font-bold text-sm">{{lang 'products.depth'}}</dt>
                    <dd>
                        {{product.depth}}
                        {{#if settings.measurements.length '==' 'Centimeters'}}
                            ({{lang 'products.measurement.metric'}})
                        {{else}}
                            ({{lang 'products.measurement.imperial'}})
                        {{/if}}
                    </dd>
                {{/all}}

                {{#if product.min_purchase_quantity}}
                    <dt class="font-bold text-sm">{{lang 'products.min_purchase_quantity'}}</dt>
                    <dd>{{lang 'products.purchase_units' quantity=product.min_purchase_quantity}}</dd>
                {{/if}}

                {{#if product.max_purchase_quantity}}
                    <dt class="font-bold text-sm">{{lang 'products.max_purchase_quantity'}}</dt>
                    <dd>{{lang 'products.purchase_units' quantity=product.max_purchase_quantity}}</dd>
                {{/if}}
                
                {{#if product.gift_wrapping_available}}
                    <dt class="font-bold text-sm">{{lang 'products.gift_wrapping'}}</dt>
                    <dd>{{lang 'products.gift_wrapping_available'}}</dd>
                {{/if}}
                
                {{#if product.shipping}}
                    {{#if product.shipping.calculated}}
                        <dt class="font-bold text-sm">{{lang 'products.shipping'}}</dt>
                        <dd>{{lang 'products.shipping_calculated'}}</dd>
                    {{else}}
                        {{#if product.shipping.price.value '===' 0}}
                            <dt class="font-bold text-sm">{{lang 'products.shipping'}}</dt>
                            <dd>{{lang 'products.shipping_free'}}</dd>
                        {{else}}
                            <dt class="font-bold text-sm">{{lang 'products.shipping'}}</dt>
                            <dd>{{lang 'products.shipping_fixed' amount=product.shipping.price.formatted}}</dd>
                        {{/if}}
                    {{/if}}
                {{/if}}

                {{#if settings.bulk_discount_enabled}}
                    <div class="js-product-view-info-bulk-pricing">
                        {{> components/products/bulk-discount-rates bulk_discount_rates=product.bulk_discount_rates}}
                    </div>
                {{/if}}

                {{#if theme_settings.show_custom_fields_tabs '!==' true}}
                    {{> components/products/custom-fields }}
                {{/if}}
            </dl>
        <div>
            {{#if product.release_date }}
                <p>{{product.release_date}}</p>
            {{/if}}

            <form 
                class="js-cart-item-add my-4" 
                method="post" 
                action="{{product.cart_url}}" 
                enctype="multipart/form-data"
            >
                <input type="hidden" name="action" value="add">
                <input type="hidden" name="product_id" value="{{product.id}}"/>

                <div class="js-product-option-change mb-4" style="display:none;">
                    {{inject 'showSwatchNames' theme_settings.show_product_swatch_names}}
                    {{#each product.options}}
                        {{{dynamicComponent 'components/products/options'}}}
                    {{/each}}
                </div>
                <div class="js-form-field js-form-field-stock{{#unless product.stock_level}} u-hidden-visually{{/unless}} mb-4">
                    <label>
                        {{lang 'products.current_stock'}}
                        <span class="js-product-stock">
                            {{product.stock_level}}
                        </span>
                    </label>
                </div>

                {{> components/products/add-to-cart with_wallet_buttons=true}}
                
                {{#if product.out_of_stock}}
                    {{#if product.out_of_stock_message}}
                        {{> components/common/alert/alert-error product.out_of_stock_message}}
                    {{else}}
                        {{> components/common/alert/alert-error (lang 'products.sold_out')}}
                    {{/if}}
                {{/if}}
            </form>
            {{#if settings.show_wishlist}}
                {{> components/common/wishlist-dropdown}}
            {{/if}}
        </div>
        {{> components/common/share url=product.url}}
    </section>

    <section class="c-product__tabs md:col-span-2 my-8">
        {{#if theme_settings.show_product_details_tabs}}
            {{> components/products/description-tabs}}
        {{else}}
            {{> components/products/description}}
        {{/if}}
    </section>
</div>

<div class="js-preview-modal fixed top-50 bg-white p-8 z-50 max-w-[90vw] max-h-[90vh] top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%] shadow-xl hidden">
    {{> components/common/modal/modal-close-btn }}

    <div class="js-modal-content"></div>
    <div class="js-loading-overlay"></div>
</div>
